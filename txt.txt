PREPARACION TALLER ENTREGA N° 2

CONTEXTO DE NEGOCIO

Dolphin Consulting es una empresa internacional de asesorías para pymes que trabaja con consultores externos especializados. Ofrece servicios financieros, administrativos, estratégicos y más, buscando aportar soluciones innovadoras y efectivas. Debido a su crecimiento, la empresa quiere automatizar el cálculo de asignaciones mensuales a sus consultores —proceso que hoy se hace manualmente— y ha contratado a un profesional externo (tú) para desarrollar este nuevo módulo de gestión de personas.







1.- REGLAS DE NEGOCIO

a)	Existe una asignación de movilización extra que se le paga a cualquier profesional que resida en algunas comunas de Santiago. Esta asignación equivale a:
●	2% de la suma de sus honorarios para aquellos profesionales que vivan en Santiago y que la suma de sus honorarios es menor a $350.000
●	4% de la suma de sus honorarios para aquellos profesionales que vivan en Ñuñoa.
●	5% de la suma de sus honorarios para aquellos profesionales que vivan en La Reina y que la suma de sus honorarios es menor a $400.000
●	7% de la suma de sus honorarios para aquellos profesionales que vivan en La Florida y que la suma de sus honorarios es menor a $800.000
●	9% de la suma de sus honorarios para aquellos profesionales que vivan en Macul y que la suma de sus honorarios es menor a $680.000
b)	Todos los profesionales tienen derecho a un incentivo adicional asociado a su tipo de contrato; este incentivo se calculará respecto de la suma de sus honorarios y los porcentajes requeridos se deben obtenerse de la tabla TIPO_CONTRATO. 

 

c)	Se pagará una asignación asociada a la profesión de cada profesional; esta asignación profesional se calculará respecto del sueldo del profesional y los porcentajes asociados a cada profesión deben obtenerse de la tabla PORCENTAJE_PROFESION. 

 

d)	El monto total de asignaciones de cada profesional corresponde a la suma de todas las asignaciones ya calculadas.

e)	La Gerencia ha decidido también que el monto total de las asignaciones de un profesional no puede exceder de un límite que dependerá de los recursos financieros de los que disponga la empresa al momento de la ejecución del proceso y que, para este período de prueba, se ha establecido en $250.000.


2.- REQUERIMIENTOS MÍNIMOS, EN TÉRMINOS DE DISEÑO, PARA CONSTRUIR EL PROCESO:

La simulación de este nuevo proceso deberá ser implementada a través de un bloque PL/SQL Anónimo. Para esto, se deberán tener presente las siguientes consideraciones:

2.1. Información que debe generar el proceso:
a)	Se deben procesar todos los profesionales. Las asesorías que deben ser consideradas por el proceso son aquellas cuya fecha de inicio corresponda al mes y año que se está procesando.

b)	Por cada profesional procesado, se debe almacenar en la tabla DETALLE_ASIGNACION MES  el mes y año de proceso, el run del profesional, nombre y apellido del profesional, profesión del profesional, número de asesorías realizadas, valor total de los honorarios correspondientes a las asesorías, asignación movilización extra, asignación por tipo de contrato, asignación por profesión y total de asignaciones de acuerdo con las reglas de negocio especificadas.

c)	También se solicita almacenar en la tabla RESUMEN_MES_PROFESION el resumen por cada profesión de los datos obtenidos por el proceso: año y mes del proceso, nombre de la profesión y los montos totales por honorarios, movilización extra, tipo de contrato, profesión y total general de asignaciones.
d)	La información de los errores que se deben controlar en el proceso deberá quedar almacenada en la tabla ERRORES_PROCESO. El valor de la columna ERROR_ID es un valor secuencial para el cual se debe usar la secuencia SQ_ERRORES.

2.2.- Consideraciones para la construcción del Proceso:
a)	Uso de variables BIND para definir:
●	Fecha del proceso por calcular
●	Valor límite del monto de asignación que se paga a los profesionales
b)	Uso de VARRAY para definir:
●	Valores de los 5 porcentajes aplicables a la asignación de movilización extra.
c)	Uso mínimo de dos REGISTROS para almacenar información.
d)	Se deberán TRUNCAR las tablas DETALLE_ASIGNACION_MES, RESUMEN_MES_PROFESION y ERRORES_PROCESO en tiempo de ejecución.  Esto permitirá poder ejecutar el bloque PL/SQL todas las veces que se requiera. 
e)	En tiempo de ejecución se debe eliminar y volver a crear la secuencia utilizada para la ID de la tabla de errores.
f)	Por eficiencia del proceso es OBLIGATORIO construir sentencias SELECT por separado de acuerdo a lo siguiente:
●	La sentencia SELECT del CURSOR SIN PARAMETRO debe obtener SOLO los datos básicos que se deben insertar en la tabla de resultado y aquellos datos que se requieren para realizar los cálculos del proceso.
●	Si para realizar cálculos se requieren obtener porcentajes de tablas, éstos se deben obtener en sentencias SELECT por separado.
●	Para obtener valores en los que se requieran usar funciones de grupo para SUMAR y CONTAR, se DEBEN realizar en sentencias SELECT por separado.  Esto significa que para obtener la cantidad de asesorías realizadas y el monto total de honorarios de las asesorías realizadas se deben construir sentencias SELECT individuales. 
●	TODOS los cálculos SE DEBEN efectuar en sentencias PL/SQL NO en las sentencias SQL utilizadas por el bloque.
g)	Todos los cálculos deben ser redondeados en valores enteros.
h)	El proceso debe considerar una EXCEPCION DEFINIDA POR EL USUARIO que permita controlar si el monto total que corresponde a las asignaciones calculadas para un profesional es superior al monto límite de asignación acordado por la empresa. De producirse esta situación se debe insertar el error en la tabla de errores del proceso y asignar al monto total de asignaciones el valor límite definido que es de $250.000.
i)	El proceso debe considerar controlar CUALQUIER ERROR ORACLE que se produzca al recuperar el porcentaje de asignación para calcular la asignación asociada a la profesión.  Para este caso se debe insertar el error en la tabla de errores del proceso y asignar CERO al valor de la asignación asociada a la profesión.
j)	En la tabla de resumen SE DEBE ORDENAR en forma ascendente por profesión.
k)	Para efectos de prueba, deberá ejecutar su proceso considerando las asesorías del mes de junio de 2021. 









