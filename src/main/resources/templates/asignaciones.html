<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Asignaciones - Sistema de Asignaciones</title>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/5.2.3/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/webjars/font-awesome/6.2.0/css/all.min.css}"/>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">Sistema de Asignaciones</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href="/asignaciones">Asignaciones</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/auditorias">Auditorías</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>Asignaciones Mensuales</h2>
        
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5>Filtrar Asignaciones</h5>
            </div>
            <div class="card-body">
                <form th:action="@{/asignaciones}" method="get" class="row g-3">
                    <div class="col-md-4">
                        <label for="mes" class="form-label">Mes:</label>
                        <select id="mes" name="mes" class="form-select">
                            <option value="">Todos</option>
                            <option value="1" th:selected="${mes == 1}">Enero</option>
                            <option value="2" th:selected="${mes == 2}">Febrero</option>
                            <option value="3" th:selected="${mes == 3}">Marzo</option>
                            <option value="4" th:selected="${mes == 4}">Abril</option>
                            <option value="5" th:selected="${mes == 5}">Mayo</option>
                            <option value="6" th:selected="${mes == 6}">Junio</option>
                            <option value="7" th:selected="${mes == 7}">Julio</option>
                            <option value="8" th:selected="${mes == 8}">Agosto</option>
                            <option value="9" th:selected="${mes == 9}">Septiembre</option>
                            <option value="10" th:selected="${mes == 10}">Octubre</option>
                            <option value="11" th:selected="${mes == 11}">Noviembre</option>
                            <option value="12" th:selected="${mes == 12}">Diciembre</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="anio" class="form-label">Año:</label>
                        <input type="number" id="anio" name="anio" class="form-control" th:value="${anio}">
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-search"></i> Filtrar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="alert alert-info" th:if="${asignaciones.empty}">
            No hay asignaciones para el período seleccionado.
        </div>

        <div th:if="${mensaje}" th:class="${'alert alert-' + (exito ? 'success' : 'danger')}" role="alert">
            <span th:text="${mensaje}"></span>
        </div>

        <div class="table-responsive" th:if="${!asignaciones.empty}">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>RUN</th>
                        <th>Nombre</th>
                        <th>Mes</th>
                        <th>Año</th>
                        <th>Honorarios</th>
                        <th>Contrato</th>
                        <th>Profesión</th>
                        <th>Movilidad</th>
                        <th>Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="asignacion : ${asignaciones}">
                        <td th:text="${asignacion.runProfesional}"></td>
                        <td th:text="${asignacion.profesional != null ? asignacion.profesional.nombre : 'N/A'}"></td>
                        <td th:text="${asignacion.mes}"></td>
                        <td th:text="${asignacion.anio}"></td>
                        <td th:text="${#numbers.formatDecimal(asignacion.asignacionHonorarios, 0, 'POINT', 0, 'COMMA')}"></td>
                        <td th:text="${#numbers.formatDecimal(asignacion.asignacionContrato, 0, 'POINT', 0, 'COMMA')}"></td>
                        <td th:text="${#numbers.formatDecimal(asignacion.asignacionProfesion, 0, 'POINT', 0, 'COMMA')}"></td>
                        <td th:text="${#numbers.formatDecimal(asignacion.asignacionMovilidad, 0, 'POINT', 0, 'COMMA')}"></td>
                        <td th:text="${#numbers.formatDecimal(asignacion.totalAsignaciones, 0, 'POINT', 0, 'COMMA')}"></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="card mt-4" th:if="${errores != null && !errores.empty}">
            <div class="card-header bg-danger text-white">
                <h5>Errores en el Procesamiento</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>RUN</th>
                                <th>Mensaje de Error</th>
                                <th>Fecha</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="error : ${errores}">
                                <td th:text="${error.runProfesional}"></td>
                                <td th:text="${error.mensajeError}"></td>
                                <td th:text="${#temporals.format(error.fechaError, 'dd/MM/yyyy HH:mm:ss')}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white mt-5 py-3">
        <div class="container text-center">
            <p>Sistema de Asignaciones &copy; 2023</p>
        </div>
    </footer>

    <script th:src="@{/webjars/jquery/3.6.1/jquery.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/5.2.3/js/bootstrap.bundle.min.js}"></script>
</body>
</html>